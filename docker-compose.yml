services:
  backend:
    build:
      context: .
      dockerfile: docker/dev.Dockerfile
    command: >
      bash -lc "cd backend &&
      npm install &&
      npm run build &&
      npm run start"
    environment:
      NODE_ENV: development
      INSTANCE_TYPE: t4g.micro
      PROJECT_TAG: vpn-pwa
      OWNER_TAG: local
      S3_CONFIG_BUCKET: your-wireguard-config-bucket
      ALLOWED_REGIONS: eu-west-3,eu-central-1,us-east-1
      DEFAULT_REGION: eu-west-3
      WIREGUARD_PORT: 51820
      AWS_SHARED_CREDENTIALS_FILE: /root/.aws/credentials
      AWS_CONFIG_FILE: /root/.aws/config
    ports:
      - '3000:3000'
    volumes:
      - ./:/workspace
      - ~/.aws:/root/.aws:ro

  ios:
    build:
      context: .
      dockerfile: docker/dev.Dockerfile
    command: >
      bash -lc "cd apps/ios &&
      npm install &&
      npm run dev -- --host 0.0.0.0"
    environment:
      NODE_ENV: development
      VITE_API_URL: http://localhost:3000
    ports:
      - '5173:5173'
    depends_on:
      - backend
    volumes:
      - ./:/workspace

  desktop:
    build:
      context: .
      dockerfile: docker/dev.Dockerfile
    command: >
      bash -lc "cd apps/desktop &&
      npm install &&
      tail -f /dev/null"
    environment:
      NODE_ENV: development
      DESKTOP_UI_URL: http://localhost:5173
    depends_on:
      - backend
      - ios
    volumes:
      - ./:/workspace
